<!DOCTYPE html>
<html>
<head>
    <title>设置支付密码</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <tc_include file="Public:head"/>
    <link rel="stylesheet" type="text/css" href="__TMPL__Public/css/reset.css">
    <link rel="stylesheet" type="text/css" href="__TMPL__Public/css/common.css">
    <link rel="stylesheet" type="text/css" href="__TMPL__Public/css/style.css">
</head>
<body>
<!--  head区域 -->
<tc_include file="Public:nav"/>
<!--mainhead区域-->
<div class="wdg-account-header">
    <div class="main-section">
        <ul class="account-menu fn-clear">
            <li class=""><a href="/index.php/user/index/index">账户总览</a></li>
            <li class=""><a href="/index.php/user/index/accountinfo">账户设置</a></li>
        </ul>
    </div>
</div>

<!-- main区域 -->
<div class="mainey">
    <div class="maingers">
        <h1><span class="child3">设置支付密码</span></h1>

        <form id="settradeform">
            <div class="content">
                <p class="child4">
                    <span class="ffer1 fonts-z"><b>*</b>输入密码</span>
                    <input name="tradepwd" type="password" class="passy1" placeholder="请输入交易密码" value="" maxlength="6"
                           onkeyup="onlyWriteNum(event,this);"
                           onkeypress="return vaildIntegerNumber(event) "
                           onpaste="return !clipboardData.getData('text').match(/\D/) "
                           ondragenter="return false" style="ime-mode:Disabled " />
        				<span class="fly1" style="display: none;">
        					<img src="__TMPL__Public/images/xx01.png"/>
        					<span></span>
        				</span>
                </p>

                <p class="child4 line1">
                    <span class="ffer1 fonts-z"><b>*</b>确认密码</span>
                    <input  name="retradepwd" class="passy2" type="password" placeholder="请确认交易密码" value="" maxlength="6"
                           onkeyup="onlyWriteNum(event,this);"
                           onkeypress="return vaildIntegerNumber(event) "
                           onpaste="return !clipboardData.getData('text').match(/\D/) "
                           ondragenter="return false" style="ime-mode:Disabled "/>
        				<span class="fly2" style="display: none;">
        					<img src="__TMPL__Public/images/xx01.png"/>
        					<span></span>
        				</span>
                </p>

                <p class="child5">
                    <span class="ffer2 fonts-z"><b>*</b>绑定手机号</span>
                    <span class="ffer3">{$phone_number}</span>
                </p>

                <p class="child6">
                    <span class="ffer4 fonts-z"><b>*</b>验证码</span>
                    <input  name="settradecode" type="text" class="assy3" placeholder="请输入验证码" maxlength="6"
                           onkeyup="onlyWriteNum(event,this);"
                           onkeypress="return vaildIntegerNumber(event) "
                           onpaste="return !clipboardData.getData('text').match(/\D/) "
                           ondragenter="return false" style="ime-mode:Disabled "/>
                    <a id="sendCode" href="javascript:void(0)">获取验证码</a>
                    	<span class="fly3" style="display: none;">
                    		<img src="__TMPL__Public/images/xx01.png"/>
        					<span></span>
                    	</span>
                    <span class="nes8" id="times"><b class="thrity"></b><span></span></span>
                </p>
                <a class="subs clearfix" id="checktradepwdcode" href="javascript:void(0)">提交</a>
            </div>
        </form>
    </div>
</div>

<!--  footer区域 -->
<tc_include file="Public:footer"/>

<script src="__TMPL__Public/js/jquery-1.8.3.min.js"></script>
<script src="__TMPL__Public/js/settradepwd.js"></script>
<script>
    $(document).ready(function () {
        $('#sendCode').click(function () {
            $('#sendCode').hide();
            var tradedata = $('#settradeform').serialize();
            $.ajax({
                url: '/index.php/user/index/settradepwdCode',
                type: 'POST',
                data: tradedata,
                success: function (data) {
                    if (data.status == 0) {
                        alert(data.msg);
                    } else if (data.status == 1) {
//                        alert(data.msg);
                        $('#sendCode').off();
                        timeDown('times', 60);
                    }
                }
            });
        });
        $('#checktradepwdcode').click(function () {
            var tradedata = $('#settradeform').serialize();
            $.ajax({
                url: '/index.php/user/index/checktradepwdCode',
                type: 'POST',
                data: tradedata,
                success: function (data) {
                    if (data.status == 0) {
                        alert(data.msg);
                    } else if (data.status == 1) {
                        alert(data.msg);
                        window.location.href = '/index.php/user/index/accountinfo'
                    }
                }
            });
        });

        function timeDown(id, n) {
            function jishi() {
                n--;
                n = n <= 0 ? 0 : n;
                if (n == 0) {
                    $('#sendCode').css('color', '#0084e8');
                    $('#' + id).empty();
                    $('#' + id).html('<b></b><span>请重新获取</span>');
                    $('.fly3').find('span').css('color','#ffffff');
                } else {
                    $("#sendCode").html('秒后重新获取');
                   $('#' + id).find('span').html('秒后重新获取');
                    $('#' + id).show().find('b').html(n);
                    $('#sendCode').css('color', '#CCCCCC');
                }
            }

            var t = setInterval(function () {
                if (n <= 0) {
                    clearTimeout(t);
                } else {
                    jishi();
                }
            }, 1000);
        }
    });
</script>
</body>
</html>
